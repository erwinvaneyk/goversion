# Go-version

Simplify versioning of Go applications.

The project consists out of two parts:
1. The version library `github.com/erwinvaneyk/go-version` for providing version
   info and corresponding operations.
2. The _optional_ `goversion` CLI to simplify generating ldflags and versioning
   fields.
   
## Installation

TODO go get

TODO section

To install the optional `goversion` CLI, use one of the following options:

### Using a pre-built release

TODO

### Using Go tools


### Using Go install
```bash
GO11MODULE=off go install github.com/erwinvaneyk/go-version/cmd/goversion 
```

Note: ensure that you have added your `GOBIN` directory to your `PATH`.

### Using Docker
If you prefer using a Docker container, rather than a local binary, add the 
following to your shell config (e.g. `~/.bashrc` or `~/.zshrc`):

```bash
alias goversion="docker run --rm erwinvaneyk/goversion:latest"
```

## Usage

There are two ways to make use of `go-version` in your project. Both assume 
that you have added the package to your module or GOPATH. If you haven't:
 
```bash
go get github.com/erwinvaneyk/go-version
```

### Using the imported package.
To use `go-version`, import and use the package somewhere in your application.  
For example:

```go
package main

import (
	"fmt"

	"github.com/erwinvaneyk/go-version"
)

func main() {
	fmt.Println(version.Get())
}
```


```bash
go run -ldflags ' \
		-X "github.com/erwinvaneyk/go-version.version=v1.0.0" \
		-X "github.com/erwinvaneyk/go-version.gitCommit=$(shell git rev-parse HEAD)" \
		-X "github.com/erwinvaneyk/go-version.buildDate=$(shell date)"' \
	    ./simple

# Or with goversion
go run $(goversion ldflags --version v1.0.1) ./simple
```

### Using generated fields
Using the package does require a long package name to be added, and is not that
extensible. So, if you have `goversion` installed, you could also generate the
ldflag fields in your main package:

```bash
goversion fields -o /path/to/your/main/package/version.gen.go
``` 

Or use the go tooling for the generation process, add the following:

```go
//go:generate goversion fields -o version.gen.go
package main

// ...
```

And run

```bash
go generate
```

Both options will generate a file with the versioninfo fields in the main 
package: 

```go
// Generated by goversion
package main

import goversion "github.com/erwinvaneyk/go-version"

// The following variables should be filled with goversion ldflags 
var (
	version   string
	gitCommit string
	buildDate string
	goVersion string
)

func init() {
	goversion.Set(goversion.Info{
		Version:   version,
		GitCommit: gitCommit,
		BuildDate: buildDate,
		GoVersion: goVersion,
	})
}
```

Using the generated code, you can now set the ldflags using the shorter 
`main` instead of the full package name:
 
```bash
go run -ldflags ' \
    		-X "main.version=v1.0.3" \
    		-X "main.gitCommit=$(shell git rev-parse HEAD)" \
    		-X "main.buildDate=$(shell date)"' \
    		./generated

# Or with goversion
go run $(goversion ldflags --pkg main --version v1.0.4) ./generated 
```

See the [examples](./examples) for complete, functioning examples.

### Using Cobra
This project contains a default command to include into your 
[Cobra](https://github.com/spf13/cobra) based CLI. Just add the following
line to the setup of your root command:   

```go
import (
	"github.com/erwinvaneyk/go-version/versionext"
)

func init() {
    // ...
	cmd.AddCommand(versionext.NewCobraCmd())
    // ...
}
```